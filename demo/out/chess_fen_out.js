function i(a){throw a;}var j=null;function o(a){return function(){return this[a]}}var q=this;function s(a,c){var b=a.split("."),d=q;!(b[0]in d)&&d.execScript&&d.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)!b.length&&void 0!==c?d[e]=c:d=d[e]?d[e]:d[e]={}}function t(a,c){function b(){}b.prototype=c.prototype;a.n=c.prototype;a.prototype=new b};function u(a){return"undefined"!=typeof a&&a!=j}function v(a,c){for(var b=1;b<arguments.length;++b)u(a.match("%s"))?a=a.replace(/%s/,arguments[b]):i(Error("Too many positional arguments to fill format string: "+a));u(a.match("%s"))&&i(Error("Not enough positional arguments to fill in format string: "+a));return a};function w(){}function x(a){this.c=a||j}x.prototype.f=function(a){this.c=a||j};x.prototype.g=o("c");function y(a,c){this.a=[];for(var b=0;b<c;++b){this.a[b]=[];for(var d=0;d<a;++d)this.a[b][d]=new x(j)}}y.prototype.j=function(a){2>a.length&&i(Error("Invalid format of coordinates: "+a));a=[a.charCodeAt(0)-97,a.substr(1,a.length)-1];(0>a[0]||this.a.length<=a[0]||0>a[1]||this.a[0].length<=a[1])&&i(Error(v("Invalid coords (%s, %s) for board (%s x %s)",a[0],a[1],this.a.length,this.a[0].length)));this.a[a[0]][a[1]].f(j)};
s("gamebuilder.games.BoardMxN.prototype.erasePieceAtPos",y.prototype.j);function z(a){this.b=a}z.prototype.d=o("b");var A=new z("black"),F=new z("white");function G(a){this.h=a}G.prototype.d=o("h");var H=new G("pawn"),I=new G("knight"),J=new G("bishop"),K=new G("rook"),L=new G("queen"),M=new G("king");function N(a,c){switch(a){case A:case F:break;default:i(Error("Invalid piece color: "+a.d()))}this.b=a;switch(c){case H:case I:case J:case K:case L:case M:break;default:i(Error("Invalid piece value: "+c.d()))}this.h=c}t(N,w);N.prototype.color=o("b");N.prototype.value=o("h");
function aa(a){switch(a){case "p":return H;case "n":return I;case "b":return J;case "r":return K;case "q":return L;case "k":return M;default:i(Error("Invalid piece char code: `"+a+"'"))}}function O(a){this.b=a}O.prototype.d=o("b");var P=new O("dark"),Q=new O("light");function T(a,c){this.c=c||j;this.c=c||j;this.b=a}t(T,x);T.prototype.f=function(a){this.c=a||j};T.prototype.g=o("c");T.prototype.color=o("b");
function U(a,c){y.call(this,a,c);this.a=[];for(var b=0;b<c;++b){this.a[b]=[];for(var d=0;d<a;++d)this.a[b][d]=new T((b+d)%2?P:Q,j)}}t(U,y);U.prototype.f=function(a,c,b){0<=a&&a<this.a.length&&0<=c&&c<this.a[0].length?this.a[a][c].f(b):i(Error("Invalid coordinates for setPiece: ("+a+", "+c+")"))};U.prototype.g=function(a,c){var b;0<=a&&a<this.a.length&&0<=c&&c<this.a[0].length?(b=[a,c],b=this.a[b[0]][b[1]].g()):b=j;return b};function V(a){U.call(this,a,a)}t(V,U);function W(){V.call(this,8)}t(W,V);function X(a,c,b,d){this.i=a;2!=a.length&&i(Error("`colors' should be an array of size 2"));this.l=c;this.k=b;2!=b.length&&i(Error("`images' should be an array of size 2"));for(a=0;a<b.length;++a)6!=b[a].length&&i(Error("`images' should be an array of 2x6, is:"+b[a].length));this.m=d}s("gamebuilder.games.chess.theme.Theme",X);var Y=j;s("gamebuilder.games.chess.theme.DEFAULT_THEME",Y);function Z(){this.e=new W}s("gamebuilder.games.chess.FEN",Z);
Z.prototype.parse=function(a,c){a=a.replace(/\n/g," ").replace(/\r/g," ");a=a.replace(/^\s+/,"").replace(/\s+$/,"");if(0==a.length)return c.push("No FEN present"),!1;var b=a.split(" ");if(1>b.length)return c.push("FEN has no information"),!1;b=b[0];c.push(b);for(var b=b.split("/"),d=this.e.a.length,e=0,k;k=b[e];++e){if(e>=d)return c.push("Row "+(e+1)+" is outside board size: "+d),!1;var l=0;c.push("row: ["+k+"]");if(!(0<=e&&e<this.e.a.length))return c.push("More data in row "+(e+1)+" ("+l+") than the board has space ("+
this.e.a.length+")"),!1;for(var n=0,f;f=k[n++];)if("1"<=f&&"8">=f)l+=f-0;else{var g;g=f==f.toLowerCase()?A:F;var p=aa(f.toLowerCase());g=new N(g,p);if(u(g))this.e.f(e,l++,g);else return c.push('Could not parse piece "'+f+'"'),!1}}return!0};
function $(){var a=document.getElementsByClassName("gamebuilder_chess_fen");if(u(a))for(var c=0,b;b=a[c++];){var d=new Z,e=[];if(d.parse(b.innerHTML,e)){b.innerHTML="";var k=d.e,d=document.createElement("table"),l=d.insertRow(-1),n=document.createElement("td"),f=document.createElement("table");f.style.border="";f.style.cellPadding=f.cellSpacing=0;for(var e=k.a.length,g=0;g<e;++g){var p=f.insertRow(-1),m=document.createElement("td");m.appendChild(document.createTextNode((e-g).toString()));m.o="middle";
p.appendChild(m)}n.appendChild(f);l.appendChild(n);n=document.createElement("td");f=document.createElement("table");f.style.border="";f.style.cellPadding=f.cellSpacing=0;for(var B=Y,ba=k.a[0].length,g=0;g<e;++g)for(var p=f.insertRow(-1),C=0;C<ba;++C){var r=k.g(g,C),D=m=document.createElement("td"),E=B,h;h=[g,C];h=k.a[h[0]][h[1]].color();var R;a:switch(h){case Q:R=E.i[0];break a;case P:R=E.i[1];break a;default:i(Error("Invalid color: "+h))}D.className=R;if(u(r)){E=D=document.createElement("img");h=
r.color();var r=r.value(),S=-1;switch(h){case F:S=0;break;case A:S=1;break;default:i(Error("Invalid color: "+h.d()))}h=-1;switch(r){case H:h=0;break;case I:h=1;break;case J:h=2;break;case K:h=3;break;case L:h=4;break;case M:h=5;break;default:i(Error("Invalid piece: "+r.d()))}E.src=B.l+"/"+B.k[S][h];D.className=B.m;m.appendChild(D)}p.appendChild(m)}n.appendChild(f);l.appendChild(n);k=d.insertRow(-1);k.appendChild(document.createElement("td"));l=document.createElement("td");p=document.createElement("table");
n=p.insertRow(-1);for(g=0;g<e;++g)m=document.createElement("td"),m.appendChild(document.createTextNode(String.fromCharCode(97+g))),m.align="center",n.appendChild(m);l.appendChild(p);k.appendChild(l);b.appendChild(d)}else b.innerHTML="Error: "+e.join("<br>")}}Z.parseAllFenInDocument=$;s("demo.chess.showFenDiagrams",function(){var a=document.location.href.replace(/[^\/]*$/,"");Y=new X(["light_sq","dark_sq"],a+"../data/images/chess",["pawn_w.png,knight_w.png,bishop_w.png,rook_w.png,queen_w.png,king_w.png".split(","),"pawn_b.png,knight_b.png,bishop_b.png,rook_b.png,queen_b.png,king_b.png".split(",")],"piece_img");$()});
