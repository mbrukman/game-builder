function g(a){throw a;}var j=!0,l=null,o=!1;function r(a){return function(){return this[a]}}var s,aa=this;function t(a,b){var c=a.split("."),d=aa;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&void 0!==b?d[e]=b:d=d[e]?d[e]:d[e]={}}
function ba(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function u(a){return"array"==ba(a)}function w(a){var b=ba(a);return"array"==b||"object"==b&&"number"==typeof a.length}function x(a){return"string"==typeof a}Math.floor(2147483648*Math.random()).toString(36);function y(a,b){function c(){}c.prototype=b.prototype;a.P=b.prototype;a.prototype=new c};var ca=/^[a-zA-Z0-9\-_.!~*'()]*$/;function A(a){a=""+a;return!ca.test(a)?encodeURIComponent(a):a};var da=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function ea(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function fa(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};var ga=Array.prototype,ha=ga.forEach?function(a,b,c){ga.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};function ia(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(u(d)||(e=w(d))&&d.hasOwnProperty("callee"))a.push.apply(a,d);else if(e)for(var f=a.length,h=d.length,i=0;i<h;i++)a[f+i]=d[i];else a.push(d)}};function ja(a){if("function"==typeof a.m)return a.m();if(x(a))return a.split("");if(w(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return ea(a)}function ka(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(w(a)||x(a))ha(a,b,c);else{var d;if("function"==typeof a.p)d=a.p();else if("function"!=typeof a.m)if(w(a)||x(a)){d=[];for(var e=a.length,f=0;f<e;f++)d.push(f)}else d=fa(a);else d=void 0;for(var e=ja(a),f=e.length,h=0;h<f;h++)b.call(c,e[h],d&&d[h],a)}};function C(a,b){this.i={};this.A={};var c=arguments.length;if(1<c){c%2&&g(Error("Uneven number of arguments"));for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof C?(c=a.p(),d=a.m()):(c=fa(a),d=ea(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}s=C.prototype;s.c=0;s.I=0;s.m=function(){var a=[],b;for(b in this.i)":"==b.charAt(0)&&a.push(this.i[b]);return a};
s.p=function(){var a=[],b;for(b in this.i)if(":"==b.charAt(0)){var c=b.substring(1);a.push(this.A[b]?Number(c):c)}return a};s.k=function(a){return":"+a in this.i};s.remove=function(a){var a=":"+a,b=this.i,c;(c=a in b)&&delete b[a];return c?(delete this.A[a],this.c--,this.I++,j):o};s.get=function(a,b){var c=":"+a;return c in this.i?this.i[c]:b};s.set=function(a,b){var c=":"+a;c in this.i||(this.I++,this.c++,"number"==typeof a&&(this.A[c]=j));this.i[c]=b};s.o=function(){return new C(this)};function D(a,b){var c;a instanceof D?(this.r(b==l?a.e:b),E(this,a.j),F(this,a.v),G(this,a.l),H(this,a.q),I(this,a.n),J(this,a.f.o()),K(this,a.u)):a&&(c=(""+a).match(da))?(this.r(!!b),E(this,c[1]||"",j),F(this,c[2]||"",j),G(this,c[3]||"",j),H(this,c[4]),I(this,c[5]||"",j),J(this,c[6]||"",j),K(this,c[7]||"",j)):(this.r(!!b),this.f=new L(l,this,this.e))}s=D.prototype;s.j="";s.v="";s.l="";s.q=l;s.n="";s.u="";s.K=o;s.e=o;
s.toString=function(){if(this.d)return this.d;var a=[];this.j&&a.push(M(this.j,na),":");this.l&&(a.push("//"),this.v&&a.push(M(this.v,na),"@"),a.push(x(this.l)?encodeURIComponent(this.l):l),this.q!=l&&a.push(":",""+this.q));this.n&&(this.l&&"/"!=this.n.charAt(0)&&a.push("/"),a.push(M(this.n,"/"==this.n.charAt(0)?oa:pa)));var b=""+this.f;b&&a.push("?",b);this.u&&a.push("#",M(this.u,qa));return this.d=a.join("")};
s.o=function(){var a=this.j,b=this.v,c=this.l,d=this.q,e=this.n,f=this.f.o(),h=this.u,i=new D(l,this.e);a&&E(i,a);b&&F(i,b);c&&G(i,c);d&&H(i,d);e&&I(i,e);f&&J(i,f);h&&K(i,h);return i};function E(a,b,c){P(a);delete a.d;a.j=c?b?decodeURIComponent(b):"":b;if(a.j)a.j=a.j.replace(/:$/,"")}function F(a,b,c){P(a);delete a.d;a.v=c?b?decodeURIComponent(b):"":b}function G(a,b,c){P(a);delete a.d;a.l=c?b?decodeURIComponent(b):"":b}
function H(a,b){P(a);delete a.d;b?(b=Number(b),(isNaN(b)||0>b)&&g(Error("Bad port number "+b)),a.q=b):a.q=l}function I(a,b,c){P(a);delete a.d;a.n=c?b?decodeURIComponent(b):"":b}function J(a,b,c){P(a);delete a.d;b instanceof L?(a.f=b,a.f.D=a,a.f.r(a.e)):(c||(b=M(b,ra)),a.f=new L(b,a,a.e))}function K(a,b,c){P(a);delete a.d;a.u=c?b?decodeURIComponent(b):"":b}function P(a){a.K&&g(Error("Tried to modify a read-only Uri"))}s.r=function(a){this.e=a;this.f&&this.f.r(a);return this};var sa=/^[a-zA-Z0-9\-_.!~*'():\/;?]*$/;
function M(a,b){var c=l;x(a)&&(c=a,sa.test(c)||(c=encodeURI(a)),0<=c.search(b)&&(c=c.replace(b,ta)));return c}function ta(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var na=/[#\/\?@]/g,pa=/[\#\?:]/g,oa=/[\#\?]/g,ra=/[\#\?@]/g,qa=/#/g;function L(a,b,c){this.h=a||l;this.D=b||l;this.e=!!c}
function Q(a){if(!a.a&&(a.a=new C,a.c=0,a.h))for(var b=a.h.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=l,f=l;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c];e=decodeURIComponent(e.replace(/\+/g," "));e=R(a,e);a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}s=L.prototype;s.a=l;s.c=l;s.add=function(a,b){Q(this);S(this);a=R(this,a);if(this.k(a)){var c=this.a.get(a);u(c)?c.push(b):this.a.set(a,[c,b])}else this.a.set(a,b);this.c++;return this};
s.remove=function(a){Q(this);a=R(this,a);if(this.a.k(a)){S(this);var b=this.a.get(a);u(b)?this.c-=b.length:this.c--;return this.a.remove(a)}return o};s.k=function(a){Q(this);a=R(this,a);return this.a.k(a)};s.p=function(){Q(this);for(var a=this.a.m(),b=this.a.p(),c=[],d=0;d<b.length;d++){var e=a[d];if(u(e))for(var f=0;f<e.length;f++)c.push(b[d]);else c.push(b[d])}return c};
s.m=function(a){Q(this);if(a)if(a=R(this,a),this.k(a)){var b=this.a.get(a);if(u(b))return b;a=[];a.push(b)}else a=[];else for(var b=this.a.m(),a=[],c=0;c<b.length;c++){var d=b[c];u(d)?ia(a,d):a.push(d)}return a};s.set=function(a,b){Q(this);S(this);a=R(this,a);if(this.k(a)){var c=this.a.get(a);u(c)?this.c-=c.length:this.c--}this.a.set(a,b);this.c++;return this};s.get=function(a,b){Q(this);a=R(this,a);if(this.k(a)){var c=this.a.get(a);return u(c)?c[0]:c}return b};
s.toString=function(){if(this.h)return this.h;if(!this.a)return"";for(var a=[],b=0,c=this.a.p(),d=0;d<c.length;d++){var e=c[d],f=A(e),e=this.a.get(e);if(u(e))for(var h=0;h<e.length;h++)0<b&&a.push("&"),a.push(f),""!==e[h]&&a.push("=",A(e[h])),b++;else 0<b&&a.push("&"),a.push(f),""!==e&&a.push("=",A(e)),b++}return this.h=a.join("")};function S(a){delete a.w;delete a.h;a.D&&delete a.D.d}s.o=function(){var a=new L;if(this.w)a.w=this.w;if(this.h)a.h=this.h;if(this.a)a.a=this.a.o();return a};
function R(a,b){var c=""+b;a.e&&(c=c.toLowerCase());return c}s.r=function(a){a&&!this.e&&(Q(this),S(this),ka(this.a,function(a,c){var d=c.toLowerCase();c!=d&&(this.remove(c),this.add(d,a))},this));this.e=a};function T(a){return"undefined"!=typeof a&&a!=l};function ua(a){this.g=a}ua.prototype.color=r("g");function va(a,b){this.b=[];for(var c=0;c<b;++c){this.b[c]=[];for(var d=0;d<a;++d)this.b[c][d]=l}};function U(a){this.g=a}U.prototype.s=r("g");var V=new U("black"),wa=new U("white");function W(a){this.F=a}W.prototype.s=r("F");var xa=new W("pawn"),ya=new W("knight"),za=new W("bishop"),Aa=new W("rook"),Ba=new W("queen"),Ca=new W("king");function X(a,b){switch(a){case V:case wa:break;default:g(Error("Invalid piece color: "+a.s()))}this.g=a;switch(b){case xa:case ya:case za:case Aa:case Ba:case Ca:break;default:g(Error("Invalid piece value: "+b.s()))}this.F=b}y(X,ua);X.prototype.color=r("g");
X.prototype.value=r("F");function Da(a){switch(a){case "p":return xa;case "n":return ya;case "b":return za;case "r":return Aa;case "q":return Ba;case "k":return Ca;default:g(Error("Invalid piece char code: `"+a+"'"))}}function Ea(a){this.g=a}Ea.prototype.s=r("g");var Fa=new Ea("dark"),Ga=new Ea("light");function Y(a,b){this.H=b||l;this.g=a}Y.prototype.B=function(a){this.H=a||l};Y.prototype.z=r("H");Y.prototype.color=r("g");
function Z(a,b){va.call(this,a,b);this.b=[];for(var c=0;c<b;++c){this.b[c]=[];for(var d=0;d<a;++d)this.b[c][d]=new Y((c+d)%2?Fa:Ga,l)}}y(Z,va);Z.prototype.B=function(a,b,c){0<=a&&a<this.b.length&&0<=b&&b<this.b[0].length?this.b[a][b].B(c):g(Error("Invalid coordinates for setPiece: ("+a+", "+b+")"))};Z.prototype.z=function(a,b){var c;0<=a&&a<this.b.length&&0<=b&&b<this.b[0].length?(c=[a,b],c=this.b[c[0]][c[1]].z()):c=l;return c};function Ha(a){Z.call(this,a,a)}y(Ha,Z);
function Ia(){Ha.call(this,8)}y(Ia,Ha);function Ja(a){function b(b){g(Error("required field '"+b+"' not found in theme: "+a))}this.O=a.tableClass||b("tableClass");this.C=a.squareClasses||b("squareClasses");2!=this.C.length&&g(Error("`colors' should be an array of size 2"));this.M=a.numberCellClass||b("numberCellClass");this.L=a.letterCellClass||b("letterCellClass");this.J=a.imagesRoot||b("imagesRoot");var c=this.G=a.pieceImages||b("pieceImages");2!=c.length&&g(Error("`images' should be an array of size 2"));for(var d=0;d<c.length;++d)6!=
c[d].length&&g(Error("`images' should be an array of 2x6, is:"+c[d].length));this.N=a.pieceImgClass||b("pieceImgClass")}t("gamebuilder.games.chess.Theme",Ja);var Ka=l;Ja.DEFAULT_THEME=Ka;function $(){this.t=new Ia}t("gamebuilder.games.chess.FEN",$);
$.prototype.parse=function(a,b){a=a.replace(/\n/g," ").replace(/\r/g," ");a=a.replace(/^\s+/,"").replace(/\s+$/,"");if(0==a.length)return b.push("No FEN present"),o;var c=a.split(" ");if(1>c.length)return b.push("FEN has no information"),o;c=c[0];b.push(c);for(var c=c.split("/"),d=this.t.b.length,e=0,f;f=c[e];++e){if(e>=d)return b.push("Row "+(e+1)+" is outside board size: "+d),o;var h=0;b.push("row: ["+f+"]");if(!(0<=e&&e<this.t.b.length))return b.push("More data in row "+(e+1)+" ("+h+") than the board has space ("+
this.t.b.length+")"),o;for(var i=0,k;k=f[i++];)if("1"<=k&&"8">=k)h+=k-0;else{var p;p=k==k.toLowerCase()?V:wa;var m=Da(k.toLowerCase());p=new X(p,m);if(T(p))this.t.B(e,h++,p);else return b.push('Could not parse piece "'+k+'"'),o}}return j};
function La(){var a=document.getElementsByClassName("gamebuilder_chess_fen");if(T(a))for(var b=0,c;c=a[b++];){var d=new $,e=[];if(d.parse(c.innerHTML,e)){c.innerHTML="";var f=d.t,d=Ka,e=document.createElement("table"),h=e.insertRow(-1),i=document.createElement("td"),k=document.createElement("table");k.style.border="";k.cellPadding=k.cellSpacing="0";for(var p=f.b.length,m=0;m<p;++m){var v=k.insertRow(-1),n=document.createElement("td");n.className=d.M;n.appendChild(document.createTextNode((p-m).toString()));
n.Q="middle";v.appendChild(n)}i.appendChild(k);h.appendChild(i);i=document.createElement("td");k=document.createElement("table");k.className=d.O;k.cellPadding=k.cellSpacing="0";for(var Na=f.b[0].length,m=0;m<p;++m)for(var v=k.insertRow(-1),N=0;N<Na;++N){var B=f.z(m,N),O=n=document.createElement("td"),la;a:{var z=[m,N],z=f.b[z[0]][z[1]].color();switch(z){case Ga:la=d.C[0];break a;case Fa:la=d.C[1];break a;default:g(Error("Invalid color: "+z))}}O.className=la;if(T(B)){var z=O=document.createElement("img"),
q=B.color(),B=B.value(),ma=-1;switch(q){case wa:ma=0;break;case V:ma=1;break;default:g(Error("Invalid color: "+q.s()))}q=-1;switch(B){case xa:q=0;break;case ya:q=1;break;case za:q=2;break;case Aa:q=3;break;case Ba:q=4;break;case Ca:q=5;break;default:g(Error("Invalid piece: "+B.s()))}z.src=d.J+"/"+d.G[ma][q];O.className=d.N;n.appendChild(O)}v.appendChild(n)}i.appendChild(k);h.appendChild(i);f=e.insertRow(-1);f.appendChild(document.createElement("td"));h=document.createElement("td");v=document.createElement("table");
v.cellPadding=v.cellSpacing="0";i=v.insertRow(-1);for(m=0;m<p;++m)n=document.createElement("td"),n.className=d.L,n.appendChild(document.createTextNode(String.fromCharCode(97+m))),n.align="center",i.appendChild(n);h.appendChild(v);f.appendChild(h);c.appendChild(e)}else c.innerHTML="Error: "+e.join("<br>")}}$.parseAllFenInDocument=La;function Ma(a,b){return new Ja({tableClass:"chess",squareClasses:["light_sq","dark_sq"],numberCellClass:"number",letterCellClass:"letter",imagesRoot:a+"../data/images/chess/"+b,pieceImages:["pawn_w.png,knight_w.png,bishop_w.png,rook_w.png,queen_w.png,king_w.png".split(","),"pawn_b.png,knight_b.png,bishop_b.png,rook_b.png,queen_b.png,king_b.png".split(",")],pieceImgClass:"piece_img"})}
t("demo.chess.showFenDiagrams",function(){var a=document.location.href.replace(/[^\/]*$/,""),b=Ma(a,"merida"),a=Ma(a,"wikimedia"),a={merida:b,wikimedia:a},c=window.location,c=(c instanceof D?c.o():new D(c,o)).f.get("theme")||"merida";Ka=a[c]||b;La()});
