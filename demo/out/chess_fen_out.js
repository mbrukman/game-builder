function g(a){throw a;}var i=!0,l=null;function p(a){return function(){return this[a]}}var q,aa=this;function r(a,b){var c=a.split("."),d=aa;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&void 0!==b?d[e]=b:d=d[e]?d[e]:d[e]={}}
function ba(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function s(a){return"array"==ba(a)}function t(a){var b=ba(a);return"array"==b||"object"==b&&"number"==typeof a.length}function u(a){return"string"==typeof a}Math.floor(2147483648*Math.random()).toString(36);function v(a,b){function c(){}c.prototype=b.prototype;a.O=b.prototype;a.prototype=new c};function x(a){return"undefined"!=typeof a&&a!=l};function ca(a){this.g=a}ca.prototype.color=p("g");function da(a,b){this.b=[];for(var c=0;c<b;++c){this.b[c]=[];for(var d=0;d<a;++d)this.b[c][d]=l}};function C(a){this.g=a}C.prototype.s=p("g");var D=new C("black"),E=new C("white");function F(a){this.D=a}F.prototype.s=p("D");var G=new F("pawn"),H=new F("knight"),I=new F("bishop"),J=new F("rook"),K=new F("queen"),L=new F("king");function N(a,b){switch(a){case D:case E:break;default:g(Error("Invalid piece color: "+a.s()))}this.g=a;switch(b){case G:case H:case I:case J:case K:case L:break;default:g(Error("Invalid piece value: "+b.s()))}this.D=b}v(N,ca);N.prototype.color=p("g");N.prototype.value=p("D");
function ea(a){switch(a){case "p":return G;case "n":return H;case "b":return I;case "r":return J;case "q":return K;case "k":return L;default:g(Error("Invalid piece char code: `"+a+"'"))}}function O(a){this.g=a}O.prototype.s=p("g");var fa=new O("dark"),ga=new O("light");function P(a,b){this.G=b||l;this.g=a}P.prototype.A=function(a){this.G=a||l};P.prototype.w=p("G");P.prototype.color=p("g");
function Q(a,b){da.call(this,a,b);this.b=[];for(var c=0;c<b;++c){this.b[c]=[];for(var d=0;d<a;++d)this.b[c][d]=new P((c+d)%2?fa:ga,l)}}v(Q,da);Q.prototype.A=function(a,b,c){0<=a&&a<this.b.length&&0<=b&&b<this.b[0].length?this.b[a][b].A(c):g(Error("Invalid coordinates for setPiece: ("+a+", "+b+")"))};Q.prototype.w=function(a,b){var c;0<=a&&a<this.b.length&&0<=b&&b<this.b[0].length?(c=[a,b],c=this.b[c[0]][c[1]].w()):c=l;return c};function R(a){Q.call(this,a,a)}v(R,Q);function ha(){R.call(this,8)}
v(ha,R);function S(a){function b(b){g(Error("required field '"+b+"' not found in theme: "+a))}this.N=a.tableClass||b("tableClass");this.B=a.squareClasses||b("squareClasses");2!=this.B.length&&g(Error("`colors' should be an array of size 2"));this.L=a.numberCellClass||b("numberCellClass");this.K=a.letterCellClass||b("letterCellClass");this.I=a.imagesRoot||b("imagesRoot");var c=this.F=a.pieceImages||b("pieceImages");2!=c.length&&g(Error("`images' should be an array of size 2"));for(var d=0;d<c.length;++d)6!=
c[d].length&&g(Error("`images' should be an array of 2x6, is:"+c[d].length));this.M=a.pieceImgClass||b("pieceImgClass")}r("gamebuilder.games.chess.Theme",S);var ia=l;S.DEFAULT_THEME=ia;var la=/^[a-zA-Z0-9\-_.!~*'()]*$/;function ma(a){a=""+a;return!la.test(a)?encodeURIComponent(a):a};var na=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function oa(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function pa(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};var qa=Array.prototype,ra=qa.forEach?function(a,b,c){qa.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=u(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};function sa(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(s(d)||(e=t(d))&&d.hasOwnProperty("callee"))a.push.apply(a,d);else if(e)for(var f=a.length,j=d.length,h=0;h<j;h++)a[f+h]=d[h];else a.push(d)}};function ta(a){if("function"==typeof a.m)return a.m();if(u(a))return a.split("");if(t(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return oa(a)}function ua(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(t(a)||u(a))ra(a,b,c);else{var d;if("function"==typeof a.p)d=a.p();else if("function"!=typeof a.m)if(t(a)||u(a)){d=[];for(var e=a.length,f=0;f<e;f++)d.push(f)}else d=pa(a);else d=void 0;for(var e=ta(a),f=e.length,j=0;j<f;j++)b.call(c,e[j],d&&d[j],a)}};function T(a,b){this.i={};this.z={};var c=arguments.length;if(1<c){c%2&&g(Error("Uneven number of arguments"));for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof T?(c=a.p(),d=a.m()):(c=pa(a),d=oa(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}q=T.prototype;q.c=0;q.H=0;q.m=function(){var a=[],b;for(b in this.i)":"==b.charAt(0)&&a.push(this.i[b]);return a};
q.p=function(){var a=[],b;for(b in this.i)if(":"==b.charAt(0)){var c=b.substring(1);a.push(this.z[b]?Number(c):c)}return a};q.k=function(a){return":"+a in this.i};q.remove=function(a){var a=":"+a,b=this.i,c;(c=a in b)&&delete b[a];return c?(delete this.z[a],this.c--,this.H++,i):!1};q.get=function(a,b){var c=":"+a;return c in this.i?this.i[c]:b};q.set=function(a,b){var c=":"+a;c in this.i||(this.H++,this.c++,"number"==typeof a&&(this.z[c]=i));this.i[c]=b};q.o=function(){return new T(this)};function U(a,b){var c;a instanceof U?(this.r(b==l?a.e:b),va(this,a.j),wa(this,a.u),xa(this,a.l),ya(this,a.q),za(this,a.n),Aa(this,a.f.o()),Ba(this,a.t)):a&&(c=(""+a).match(na))?(this.r(!!b),va(this,c[1]||"",i),wa(this,c[2]||"",i),xa(this,c[3]||"",i),ya(this,c[4]),za(this,c[5]||"",i),Aa(this,c[6]||"",i),Ba(this,c[7]||"",i)):(this.r(!!b),this.f=new V(l,this,this.e))}q=U.prototype;q.j="";q.u="";q.l="";q.q=l;q.n="";q.t="";q.J=!1;q.e=!1;
q.toString=function(){if(this.d)return this.d;var a=[];this.j&&a.push(W(this.j,Ca),":");this.l&&(a.push("//"),this.u&&a.push(W(this.u,Ca),"@"),a.push(u(this.l)?encodeURIComponent(this.l):l),this.q!=l&&a.push(":",""+this.q));this.n&&(this.l&&"/"!=this.n.charAt(0)&&a.push("/"),a.push(W(this.n,"/"==this.n.charAt(0)?Da:Ea)));var b=""+this.f;b&&a.push("?",b);this.t&&a.push("#",W(this.t,Fa));return this.d=a.join("")};
q.o=function(){var a=this.j,b=this.u,c=this.l,d=this.q,e=this.n,f=this.f.o(),j=this.t,h=new U(l,this.e);a&&va(h,a);b&&wa(h,b);c&&xa(h,c);d&&ya(h,d);e&&za(h,e);f&&Aa(h,f);j&&Ba(h,j);return h};function va(a,b,c){X(a);delete a.d;a.j=c?b?decodeURIComponent(b):"":b;if(a.j)a.j=a.j.replace(/:$/,"")}function wa(a,b,c){X(a);delete a.d;a.u=c?b?decodeURIComponent(b):"":b}function xa(a,b,c){X(a);delete a.d;a.l=c?b?decodeURIComponent(b):"":b}
function ya(a,b){X(a);delete a.d;b?(b=Number(b),(isNaN(b)||0>b)&&g(Error("Bad port number "+b)),a.q=b):a.q=l}function za(a,b,c){X(a);delete a.d;a.n=c?b?decodeURIComponent(b):"":b}function Aa(a,b,c){X(a);delete a.d;b instanceof V?(a.f=b,a.f.C=a,a.f.r(a.e)):(c||(b=W(b,Ga)),a.f=new V(b,a,a.e))}function Ba(a,b,c){X(a);delete a.d;a.t=c?b?decodeURIComponent(b):"":b}function X(a){a.J&&g(Error("Tried to modify a read-only Uri"))}q.r=function(a){this.e=a;this.f&&this.f.r(a);return this};var Ha=/^[a-zA-Z0-9\-_.!~*'():\/;?]*$/;
function W(a,b){var c=l;u(a)&&(c=a,Ha.test(c)||(c=encodeURI(a)),0<=c.search(b)&&(c=c.replace(b,Ia)));return c}function Ia(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Ca=/[#\/\?@]/g,Ea=/[\#\?:]/g,Da=/[\#\?]/g,Ga=/[\#\?@]/g,Fa=/#/g;function V(a,b,c){this.h=a||l;this.C=b||l;this.e=!!c}
function Y(a){if(!a.a&&(a.a=new T,a.c=0,a.h))for(var b=a.h.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=l,f=l;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c];e=decodeURIComponent(e.replace(/\+/g," "));e=Z(a,e);a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}q=V.prototype;q.a=l;q.c=l;q.add=function(a,b){Y(this);$(this);a=Z(this,a);if(this.k(a)){var c=this.a.get(a);s(c)?c.push(b):this.a.set(a,[c,b])}else this.a.set(a,b);this.c++;return this};
q.remove=function(a){Y(this);a=Z(this,a);if(this.a.k(a)){$(this);var b=this.a.get(a);s(b)?this.c-=b.length:this.c--;return this.a.remove(a)}return!1};q.k=function(a){Y(this);a=Z(this,a);return this.a.k(a)};q.p=function(){Y(this);for(var a=this.a.m(),b=this.a.p(),c=[],d=0;d<b.length;d++){var e=a[d];if(s(e))for(var f=0;f<e.length;f++)c.push(b[d]);else c.push(b[d])}return c};
q.m=function(a){Y(this);if(a)if(a=Z(this,a),this.k(a)){var b=this.a.get(a);if(s(b))return b;a=[];a.push(b)}else a=[];else for(var b=this.a.m(),a=[],c=0;c<b.length;c++){var d=b[c];s(d)?sa(a,d):a.push(d)}return a};q.set=function(a,b){Y(this);$(this);a=Z(this,a);if(this.k(a)){var c=this.a.get(a);s(c)?this.c-=c.length:this.c--}this.a.set(a,b);this.c++;return this};q.get=function(a,b){Y(this);a=Z(this,a);if(this.k(a)){var c=this.a.get(a);return s(c)?c[0]:c}return b};
q.toString=function(){if(this.h)return this.h;if(!this.a)return"";for(var a=[],b=0,c=this.a.p(),d=0;d<c.length;d++){var e=c[d],f=ma(e),e=this.a.get(e);if(s(e))for(var j=0;j<e.length;j++)0<b&&a.push("&"),a.push(f),""!==e[j]&&a.push("=",ma(e[j])),b++;else 0<b&&a.push("&"),a.push(f),""!==e&&a.push("=",ma(e)),b++}return this.h=a.join("")};function $(a){delete a.v;delete a.h;a.C&&delete a.C.d}q.o=function(){var a=new V;if(this.v)a.v=this.v;if(this.h)a.h=this.h;if(this.a)a.a=this.a.o();return a};
function Z(a,b){var c=""+b;a.e&&(c=c.toLowerCase());return c}q.r=function(a){a&&!this.e&&(Y(this),$(this),ua(this.a,function(a,c){var d=c.toLowerCase();c!=d&&(this.remove(c),this.add(d,a))},this));this.e=a};function Ja(a,b){var c=new ha,a=a.replace(/\n/g," ").replace(/\r/g," "),a=a.replace(/\s+/," "),a=a.replace(/^\s+/,"").replace(/\s+$/,"");if(0==a.length)return b.push("No FEN present"),l;var d=a.split(" ");if(1>d.length)return b.push("FEN has no information"),l;d=d[0];b.push(d);for(var d=d.split("/"),e=c.b.length,f=0,j;j=d[f];++f){if(f>=e)return b.push("Row "+(f+1)+" is outside board size: "+e),l;var h=0;b.push("row: ["+j+"]");if(!(0<=f&&f<c.b.length))return b.push("More data in row "+(f+1)+" ("+h+
") than the board has space ("+c.b.length+")"),l;for(var y=0,k;k=j[y++];){if(!(0<=h&&h<c.b[0].length))return b.push("More data in col "+(h+1)+" ("+k+") than the board has space ("+c.b[0].length+")"),l;if("1"<=k&&"8">=k){var n=k-0;if(!(0<=h+n-1&&h+n-1<c.b[0].length))return b.push("Increment "+k+" is too high; the board only has "+c.b[0].length+" columns."),l;h+=n}else{n=l;try{var m=k==k.toLowerCase()?D:E,ja=ea(k.toLowerCase()),n=new N(m,ja)}catch(z){return b.push(z),l}if(x(n))c.A(f,h++,n);else return b.push('Could not parse piece "'+
k+'"'),l}}}return c};function Ka(a,b){return new S({tableClass:"chess",squareClasses:["light_sq","dark_sq"],numberCellClass:"number",letterCellClass:"letter",imagesRoot:a+"../data/images/chess/"+b,pieceImages:["pawn_w.png,knight_w.png,bishop_w.png,rook_w.png,queen_w.png,king_w.png".split(","),"pawn_b.png,knight_b.png,bishop_b.png,rook_b.png,queen_b.png,king_b.png".split(",")],pieceImgClass:"piece_img"})}
function La(a,b){var c=[],d=Ja(a,c);if(d!=l){b.innerHTML="";var c=ia,e=document.createElement("table"),f=e.insertRow(-1),j=document.createElement("td"),h=document.createElement("table");h.style.border="";h.cellPadding=h.cellSpacing="0";for(var y=d.b.length,k=0;k<y;++k){var n=h.insertRow(-1),m=document.createElement("td");m.className=c.L;m.appendChild(document.createTextNode((y-k).toString()));m.P="middle";n.appendChild(m)}j.appendChild(h);f.appendChild(j);j=document.createElement("td");h=document.createElement("table");
h.className=c.N;h.cellPadding=h.cellSpacing="0";for(var ja=d.b[0].length,k=0;k<y;++k)for(var n=h.insertRow(-1),z=0;z<ja;++z){var A=d.w(k,z),M=m=document.createElement("td"),B;a:{var w=[k,z],w=d.b[w[0]][w[1]].color();switch(w){case ga:B=c.B[0];break a;case fa:B=c.B[1];break a;default:g(Error("Invalid color: "+w))}}M.className=B;if(x(A)){var w=M=document.createElement("img"),o=A.color(),A=A.value(),ka=-1;switch(o){case E:ka=0;break;case D:ka=1;break;default:g(Error("Invalid color: "+o.s()))}o=-1;switch(A){case G:o=
0;break;case H:o=1;break;case I:o=2;break;case J:o=3;break;case K:o=4;break;case L:o=5;break;default:g(Error("Invalid piece: "+A.s()))}w.src=c.I+"/"+c.F[ka][o];M.className=c.M;m.appendChild(M)}n.appendChild(m)}j.appendChild(h);f.appendChild(j);d=e.insertRow(-1);d.appendChild(document.createElement("td"));B=document.createElement("td");f=document.createElement("table");f.cellPadding=f.cellSpacing="0";n=f.insertRow(-1);for(k=0;k<y;++k)m=document.createElement("td"),m.className=c.K,m.appendChild(document.createTextNode(String.fromCharCode(97+
k))),m.align="center",n.appendChild(m);B.appendChild(f);d.appendChild(B);b.appendChild(e)}else b.innerHTML="Error: "+c.join("<br>")}r("demo.chess.parseAndDisplayFen",La);
r("demo.chess.showFenDiagrams",function(){var a=document.location.href.replace(/[^\/]*$/,""),b=Ka(a,"merida"),a=Ka(a,"wikimedia"),a={merida:b,wikimedia:a},c=window.location,c=(c instanceof U?c.o():new U(c,!1)).f.get("theme")||"merida";ia=a[c]||b;b=document.getElementsByName("gamebuilder_chess_fen");if(x(b))for(a=0;a<b.length;++a)c=b[a],La(c.innerHTML,c)});
